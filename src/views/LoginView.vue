<script setup lang="ts">
const router = useRouter()

import { useToast } from '@/components/ui/toast/use-toast'
const { toast } = useToast()

import { Loader } from 'lucide-vue-next' // iconos

// TS interface
interface FormData {
  email: string
  password: string
}

// data
const dataFormulario = ref({
  email: '',
  password: '',
})

// methods
const handleForm = async (formData: FormData) => {
  const { error } = await supabase.auth.signInWithPassword(formData)
  if (error) {
    toast({
      title: 'Error',
      description: 'Email 칩 contrase침a incorrectos',
      variant: 'destructive',
    })
    dataFormulario.value.password = ''
  }
  return router.push({ name: 'dashboard' })
}
</script>

<template>
  <div class="w-full lg:grid lg:min-h-[600px] lg:grid-cols-1 xl:min-h-[800px]">
    <div class="flex items-center justify-center py-12">
      <div class="mx-auto grid w-[350px] gap-6">
        <div class="grid gap-2 text-center">
          <svg
            id="logo"
            version="1.1"
            xmlns:xlink="http://www.w3.org/2000/svg"
            x="0"
            y="0"
            viewBox="0 0 162.29 114.2"
            xml:space="preserve"
            class="mx-auto mb-4 w-96"
            style="width: 5rem"
          >
            <path
              class="st0"
              d="M8.72 18.4v10.06h9.88v29.9h4.9c.67-1.5 2.54-1.95 3.92-1.95.87 0 2.19.35 3.51.95v-28.9h9.88V18.4H8.72zM57.34 48.6v-6.16h11.35v-8.67H57.34V28.4h16.04v-10H45.02v39.96h15.09c2.32-1.87 4.58-2.97 6.61-2.97 2.18 0 4.44 1.03 6.02 2.97h1.07V48.6H57.34zM90.77 48.17V18.4H78.99v39.96h15.12c2.32-1.87 4.58-2.97 6.61-2.97 1.72 0 3.49.64 4.93 1.86v-9.08H90.77z"
            ></path>
            <path
              class="Logo_colorLogo__xGVZt"
              d="M7.16 113.66c-1.63 0-6.05-2.58-6.05-4.56 4.01-8.43 22.71-44.2 23.46-47.12.48-1.84 2.58-2.38 4.08-2.38 1.09 0 2.86.54 4.49 1.43 2.24-.95 4.69-1.56 7-1.56 4.01 0 7.75 1.9 9.72 7.27 1.09 1.22 1.63 2.45 1.63 3.67 0 6.53-13.53 13.19-18.9 15.5l-.07.07c0 .14.14.27.2.27 6.8.68 9.66 4.08 9.66 8.23 0 7.55-9.38 17.41-21.89 17.41-3.33 0-7.89-.82-9.59-3.81-.75 1.43-1.5 2.86-2.18 4.28-.47 1.02-1.02 1.3-1.56 1.3zm9.04-9.32c6.39 0 16.39-7.34 16.39-11.97 0-2.18-2.18-3.74-7.75-3.74-1.16 0-2.18-.07-2.86-.54a376.39 376.39 0 00-8.7 15.43c.61.48 1.56.82 2.92.82zM41.43 69.6c0-1.02-1.29-1.63-3.26-1.63-.95 0-2.04.14-3.2.41-3.67 5.17-6.94 10-9.86 14.62 5.03-2.25 16.32-8.3 16.32-13.4z"
              fill="red"
            ></path>
            <path
              class="Logo_colorLogo__xGVZt"
              d="M67.95 58.58c2.86 0 5.85 1.77 7.28 5.03 3.81 1.16 6.8 2.11 6.8 6.93 0 8.77-15.98 43.04-28.56 43.04-1.16 0-2.18-.27-3.26-.88-6.46-1.77-9.04-6.46-9.04-12.44-.01-12.85 16.37-41.68 26.78-41.68zm4.69 14.35c0-.95-.34-3.4-1.97-3.4-7.34 0-21.35 24.68-21.35 33.18 0 2.65.88 4.69 2.65 4.69 8.09 0 20.67-28.22 20.67-34.47zM101.95 58.58c2.86 0 5.85 1.77 7.28 5.03 3.81 1.16 6.8 2.11 6.8 6.93 0 8.77-15.98 43.04-28.56 43.04-1.16 0-2.18-.27-3.26-.88-6.46-1.77-9.04-6.46-9.04-12.44-.01-12.85 16.37-41.68 26.78-41.68zm4.69 14.35c0-.95-.34-3.4-1.97-3.4-7.34 0-21.35 24.68-21.35 33.18 0 2.65.88 4.69 2.65 4.69 8.09 0 20.67-28.22 20.67-34.47zM128.67 93.26c0 5.78 4.21 14.35 7.07 15.5.75.27 1.29.54 1.29.88 0 1.63-4.76 3.06-6.59 3.06-7.07 0-7.82-9.72-8.23-16.45-.07-.61-.41-.61-.61-.61-2.04 0-5.58 9.18-10.2 16.73-.48 1.02-1.02 1.29-1.56 1.29-1.63 0-6.05-2.58-6.05-4.56 4.01-8.43 22.71-44.2 23.46-47.12.48-1.84 2.58-2.38 4.08-2.38 2.52 0 8.29 2.72 8.29 5.64 0 .75-.41 1.29-.82 1.77-3.26 3.74-6.53 8.5-9.32 13.39 0 0-.2.34-.2.48 0 .2.14.41.61.41 2.38 0 17.81-15.98 20.87-19.45 0 0 1.63-1.63 2.99-1.63 3.26 0 7.55 1.84 7.55 4.62 0 .95-.54 1.9-1.84 2.99-10.33 7.34-30.05 20.19-30.67 23.93-.05.49-.12.96-.12 1.51z"
              fill="red"
            ></path>
            <path
              d="M145.05 0l-22.34 19.53c-1.84 1.47-3.07 3.24-3.33 5.58l-3.33 33.71.44.22 3.65-32.66a8.816 8.816 0 013.13-5.82L144.3 2.95l.64.78c.48.59 1.22.96 1.97.84h.02l.6-.1-.74.62-20.14 18.16a7.526 7.526 0 00-2.44 4.81l-4.17 32.02c-.04.35.38.56.64.31l25.35-23.6 4.85-33.32L145.05 0zm-1.74 23.27l-13.79 12.6 1.01-8.04 13.94-13.04-1.16 8.48z"
              fill="gray"
            ></path>
          </svg>
          <h1 class="text-3xl font-bold">Bienvenido</h1>
          <p class="text-balance text-muted-foreground">Ingresa a tu cuenta para continuar</p>
        </div>
        <FormKit
          v-model="dataFormulario"
          type="form"
          @submit="handleForm"
          :config="{ validationVisibility: 'submit' }"
          :actions="false"
        >
          <template #default="{ state }">
            <FormKit
              type="email"
              name="email"
              id="email"
              label="Email"
              placeholder="profesor@mail.com"
              validation="required|email"
              data-test="login-input-email"
            />
            <FormKit
              type="password"
              name="password"
              id="password"
              label="Contrase침a"
              placeholder="tu contrase침a"
              validation="required"
              data-test="login-input-password"
            />
            <div class="flex">
              <Button data-test="login-button" :disabled="state.loading" class="mx-auto">
                <Loader v-if="state.loading" class="mr-2 h-6 w-6 animate-spin" />
                Ingresar
              </Button>
            </div>
          </template>
        </FormKit>
      </div>
    </div>
  </div>
</template>
